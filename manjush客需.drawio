<mxfile host="Electron" modified="2024-05-18T15:41:19.467Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/24.4.0 Chrome/120.0.6099.109 Electron/28.1.0 Safari/537.36" etag="QJ7Q9CBLcJQ3TphCYyCM" version="24.4.0" type="device">
  <diagram name="第 1 页" id="geoylxU86lUYmxQxJ0D3">
    <mxGraphModel dx="2048" dy="2000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="u5DdF1ahz81uG0NHdDWt-1" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;客需下单：&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="-160" y="-160" width="110" height="40" as="geometry" />
        </mxCell>
        <mxCell id="u5DdF1ahz81uG0NHdDWt-2" value="小度音箱下单&lt;div&gt;com.homeinns.manjushwisdomhotel.controller.CustomerNeedsController#Xdhitmission&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry y="-40" width="570" height="40" as="geometry" />
        </mxCell>
        <mxCell id="u5DdF1ahz81uG0NHdDWt-3" value="讯飞音箱" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="4.5" y="540" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="u5DdF1ahz81uG0NHdDWt-4" value="随行管家H5页面&lt;div&gt;com.homeinns.manjushh5.controller.RoomServiceController#RoomSubmitOrder&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-0.5" y="590" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="u5DdF1ahz81uG0NHdDWt-5" value="小程序下单" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="4.5" y="655" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="u5DdF1ahz81uG0NHdDWt-7" value="下单" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="2" y="-120" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="u5DdF1ahz81uG0NHdDWt-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="u5DdF1ahz81uG0NHdDWt-9">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="461" y="230" as="targetPoint" />
            <Array as="points">
              <mxPoint x="410" y="160" />
              <mxPoint x="410" y="160" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="u5DdF1ahz81uG0NHdDWt-9" value="下单流程：（wisdomhotel）&lt;div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;1、redis验证是否有重复订单&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;2、查询manjush_xd_materials门店信息配置(&lt;span style=&quot;&quot;&gt;这里其实有问题 下面具体业务区分了如家和逸扉酒店，逸扉的酒店在这里配置其实只是自己骗自己 但是要配置进去)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;3、&lt;span style=&quot;&quot;&gt;判断是哪一种客需（送物、维修、打扫）&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;3.1逸扉的查询manjush_voice_box_device音箱信息&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;3.2、如家的继续拼接参数&lt;/div&gt;&lt;div&gt;4、验证入住单信息&lt;/div&gt;&lt;div&gt;5、继续拼接参数，拼接完了之后调用H5服务的RoomSubmitOrder&lt;/div&gt;&lt;div&gt;6、后续操作 redisKey交互次数、接口调用次数&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;textShadow=0;labelBackgroundColor=none;labelBorderColor=none;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="-0.5" y="10" width="920" height="170" as="geometry" />
        </mxCell>
        <mxCell id="u5DdF1ahz81uG0NHdDWt-10" value="RoomSubmitOrder客需流程：&lt;div&gt;&lt;div&gt;1、下单信息验证，redisf防重复key：MANJUSH:UNIQUE:ORDER:unique（免登token：Bearer b12c51c6-7a0b-4858-86af-daae70a21a93）&lt;/div&gt;&lt;div&gt;2、order_info判断是否有入住单&lt;/div&gt;&lt;div&gt;3.1、客房送物、借物&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;3.1.1、&lt;span style=&quot;background-color: initial;&quot;&gt;manjush_service_management验证 第三方机器人厂商&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;THIRDPART_NAME&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;、配送方式&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;SERVICE_TYPE以及配送时间&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;3.1.2、&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;THIRDPART_NAME不为空，走机器人配送；为空走人工&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;3.1.2.1、查询配送时间、以及多台机器人送物优先级、机器人厂商名&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;manjush_task_config，不在时间范围内走人工&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;3.1.2.2、时间、优先级、厂商确定之后，发送机器人送物请求&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;3.1.2.3、&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;com.homeinns.manjushh5.service.impl.RoomServiceImpl#banzidong存入文殊相关表，&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;设置redis Key&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;MANJUSH:UNIQUE:ORDER:unique，推送消息给消息队列&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;备注：&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;目前厂商有：云迹、景吾、九号、立名、擎朗、菲利斯&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;有的厂商有全自动机器人send_type=0，其他的走半自动或者人工&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;代码上看&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;manjush_service_management表里0代表全自动机器人送物(取物对接货柜)，1代表半自动机器人送物(人工放东西进去)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;存入文殊送物还涉及manjush_goods_detail表、&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;manjush_order_goods表、room_info表、&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;hotel_info表、&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;hotel_info_new表、&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;manjush_p3_hotelsn表、error_data表&lt;/span&gt;&lt;/div&gt;&lt;div&gt;3.2、其他需求走人工送物：&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;com.homeinns.manjushh5.service.impl.RoomServiceImpl#artificialOrder存入文殊相关表、&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;设置redis Key&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;MANJUSH:UNIQUE:ORDER:unique，推送消息给消息队列&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#f5f5f5;fontColor=#333333;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="2" y="230" width="980.5" height="280" as="geometry" />
        </mxCell>
        <mxCell id="u5DdF1ahz81uG0NHdDWt-15" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;客需入口：&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-160" y="-760" width="110" height="40" as="geometry" />
        </mxCell>
        <mxCell id="u5DdF1ahz81uG0NHdDWt-17" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;逻辑下单入口：&lt;br&gt;&lt;/font&gt;&lt;blockquote style=&quot;margin: 0 0 0 40px; border: none; padding: 0px;&quot;&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;&amp;nbsp;&lt;font style=&quot;font-size: 14px;&quot;&gt;小度音箱&lt;/font&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;&amp;nbsp;讯飞音箱&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;&amp;nbsp;H5智能管家APP：com.homeinns.manjushh5.controller.RoomServiceController#RoomSubmitOrder&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;&amp;nbsp;小程序&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;根据方法名找到的入口：&lt;/div&gt;&lt;blockquote style=&quot;margin: 0 0 0 40px; border: none; padding: 0px;&quot;&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;菲利斯送物：&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;com.homeinns.manjushh5.controller.FitnessController#deliver(FitnessDeliverDTO)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;客房服务提交订单接口：&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;com.homeinns.manjushh5.controller.RoomServiceController#RoomSubmitOrder&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;机器人下单半自动加全自动：&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;com.homeinns.manjushtask.controller.TaskController#taskSumbit&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;线下订单通知音箱：&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;com.homeinns.manjushtask.controller.RobotTaskV2Controller#voiceNotice&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; 小度线上客需：&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;com.homeinns.manjushwisdomhotel.controller.CustomerNeedsController#Xdhitmission&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-40" y="-720" width="780.5" height="280" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
